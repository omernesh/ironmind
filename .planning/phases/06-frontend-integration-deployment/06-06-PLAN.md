---
phase: 06-frontend-integration-deployment
plan: 06
type: execute
wave: 3
depends_on: ["06-04"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "IRONMIND accessible via HTTPS at configured domain"
    - "SSL certificate issued and valid"
    - "All services healthy and responding"
    - "User can register, upload document, and chat"
  artifacts: []
  key_links: []
---

<objective>
Deploy IRONMIND to Hetzner VPS with HTTPS

Purpose: Complete production deployment for IAI evaluation
Output: Live system accessible via HTTPS with all features functional
</objective>

<execution_context>
@C:\Users\Omer\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Omer\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-frontend-integration-deployment/06-RESEARCH.md
@infra/docker-compose.prod.yml
@infra/Caddyfile
@docs/DEPLOYMENT.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Provision Hetzner VPS and configure DNS</name>
  <action>
User must provision a Hetzner VPS and configure DNS records. Claude cannot access Hetzner accounts or domain registrars.

**Steps for user:**

1. **Provision VPS:**
   - Go to https://console.hetzner.cloud
   - Create new server: CX21 (2 vCPU, 4GB RAM) or CX31 (2 vCPU, 8GB RAM)
   - Select Ubuntu 22.04 LTS
   - Add your SSH key
   - Note the IP address

2. **Configure DNS:**
   - In your domain registrar (Cloudflare, Namecheap, etc.)
   - Add A record: `ironmind.yourdomain.com` -> server IP
   - Add A record: `api.ironmind.yourdomain.com` -> server IP
   - Wait for DNS propagation (can take 5-30 minutes)

3. **Verify DNS:**
   ```bash
   dig ironmind.yourdomain.com
   dig api.ironmind.yourdomain.com
   ```
   Both should return your server IP.
  </action>
  <what-user-provides>
- Server IP address
- Domain name (e.g., ironmind.example.com)
- Confirmation that DNS is configured
  </what-user-provides>
  <resume-signal>Provide server IP and domain name when ready</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Install Docker and clone repository on VPS</name>
  <files></files>
  <action>
SSH into the VPS and run setup commands:

```bash
# SSH into server (user provides IP)
ssh root@${SERVER_IP}

# Update system
apt update && apt upgrade -y

# Install Docker
curl -fsSL https://get.docker.com | sh

# Install Docker Compose plugin
apt install docker-compose-plugin -y

# Verify installation
docker --version
docker compose version

# Create deployment user
useradd -m -s /bin/bash deploy
usermod -aG docker deploy

# Switch to deploy user
su - deploy

# Clone repository
git clone https://github.com/YOUR-REPO/ironmind.git
cd ironmind

# Verify clone
ls -la
```

Note: Replace YOUR-REPO with actual repository URL.
  </action>
  <verify>SSH to server shows ironmind directory with all files</verify>
  <done>Docker installed and repository cloned on VPS</done>
</task>

<task type="auto">
  <name>Task 3: Configure production environment and deploy</name>
  <files></files>
  <action>
On the VPS:

```bash
# Navigate to infra directory
cd ~/ironmind/infra

# Create production environment file
cat > .env.production << 'EOF'
# Domain configuration
DOMAIN=ironmind.yourdomain.com

# URLs (replace with your actual domain)
NEXT_PUBLIC_APP_URL=https://ironmind.yourdomain.com
NEXT_PUBLIC_API_URL=https://api.ironmind.yourdomain.com
CORS_ORIGINS=https://ironmind.yourdomain.com

# Auth secret (generate fresh)
AUTH_SECRET=$(openssl rand -hex 32)

# API Keys (user must provide)
OPENAI_API_KEY=sk-...
DEEPINFRA_API_KEY=...

# FalkorDB (no password for POC)
FALKORDB_PASSWORD=
EOF

# Edit to add actual API keys
nano .env.production

# Update Caddyfile with actual domain
sed -i 's/{$DOMAIN}/ironmind.yourdomain.com/g' Caddyfile

# Build and start services
docker compose -f docker-compose.prod.yml --env-file .env.production up -d --build

# Wait for services to start (Docling takes longest ~60s)
sleep 90

# Check service health
docker compose -f docker-compose.prod.yml ps

# View logs for any errors
docker compose -f docker-compose.prod.yml logs --tail=50
```

Services should all show "healthy" status.
  </action>
  <verify>`docker compose ps` shows all services running and healthy</verify>
  <done>All services deployed and running on VPS</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 4: Verify production deployment</name>
  <what-built>
Complete IRONMIND deployment on Hetzner VPS with:
- Caddy reverse proxy with automatic HTTPS
- Frontend at https://ironmind.yourdomain.com
- Backend API at https://api.ironmind.yourdomain.com
- All supporting services (FalkorDB, Docling)
  </what-built>
  <how-to-verify>
1. **SSL Certificate:**
   - Visit https://ironmind.yourdomain.com
   - Click the lock icon - verify valid SSL certificate
   - Certificate should be from Let's Encrypt

2. **Landing Page:**
   - Verify IAI logo visible
   - Verify "Upload up to 10 documents" text
   - Verify POC disclaimer visible

3. **Authentication:**
   - Click "Get Started" / "Register"
   - Create a new account
   - Verify login works
   - Verify dashboard loads

4. **Document Upload:**
   - Upload a test PDF or DOCX
   - Verify progress bar shows
   - Wait for status to change to "Indexed"

5. **Chat:**
   - Click "Start Chatting"
   - Ask a question about uploaded document
   - Verify answer appears with citations
   - Verify citation cards expand on click

6. **API Health:**
   ```bash
   curl https://api.ironmind.yourdomain.com/health
   # Should return: {"status": "healthy", ...}
   ```
  </how-to-verify>
  <resume-signal>Type "verified" if all checks pass, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. HTTPS accessible at configured domain
2. Valid SSL certificate (not self-signed)
3. All UI features work: landing, auth, upload, chat
4. API responds to health checks
5. No errors in docker logs
</verification>

<success_criteria>
- INFRA-04 COMPLETE: System deployed to Hetzner VPS with HTTPS termination
- All Phase 6 success criteria met:
  1. IAI logo displayed, no LobeChat branding
  2. Landing page explains usage with POC disclaimer
  3. Document upload with status tracking
  4. Chat with inline citations
  5. User-friendly error messages
  6. HTTPS deployment on Hetzner
  7. Complete documentation
</success_criteria>

<output>
After completion, create `.planning/phases/06-frontend-integration-deployment/06-06-SUMMARY.md`
</output>
